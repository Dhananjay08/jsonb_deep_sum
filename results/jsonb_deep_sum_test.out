create extension jsonb_deep_sum;
select jsonb_deep_add('{"a": 2, "b": 1}', '{"a": 5}');
  jsonb_deep_add  
------------------
 {"a": 7, "b": 1}
(1 row)

select jsonb_deep_add('{"a": 2, "b": 3}', '{"a": 5, "b": 4}');
  jsonb_deep_add  
------------------
 {"a": 7, "b": 7}
(1 row)

select jsonb_deep_add('{"b": 1}', '{"a": 2}');
  jsonb_deep_add  
------------------
 {"a": 2, "b": 1}
(1 row)

select jsonb_deep_add('{}', '{"a": 2}');
 jsonb_deep_add 
----------------
 {"a": 2}
(1 row)

select jsonb_deep_add('1', '{"a": 1}');
ERROR:  Can only sum objects
select jsonb_deep_add('{"a": "bb"}', '{"b": 1}');
ERROR:  Only numeric values allowed
select jsonb_deep_add('{"a": {"a": 1}}', '{"b": 1}');
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
connection to server was lost
